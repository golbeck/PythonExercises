#dependency: tweet_processingV3.py
##############################################################################################################
##############################################################################################################
##############################################################################################################
#FUNCTIONS FOR SENTIMENT 
##############################################################################################################
##############################################################################################################
##############################################################################################################
from nltk.corpus import wordnet
def get_wordnet_pos(treebank_tag):
#    {'NN':'n', 'VB':'v', 'JJ':'a', 'RB':'r'}
    if treebank_tag.startswith('J'):
        return wordnet.ADJ
    elif treebank_tag.startswith('V'):
        return wordnet.VERB
    elif treebank_tag.startswith('N'):
        return wordnet.NOUN
    elif treebank_tag.startswith('R'):
        return wordnet.ADV
    else:
        return ''
#######################################################

def get_sentiment(tweet_text,i):
    #input: list of tokens and an integer indicating an element of the list
    #output: tuple of (pos sentiment,neg sentiment)
    try:
        sent_out=swn.senti_synsets(tweet_text[0][i][0],get_wordnet_pos(tweet_text[0][i][1]))
        if len(sent_out)>0:
            sent_out=sent_out[0]
            swn_score=(sent_out.pos_score,sent_out.neg_score)
        else:
            swn_score=(0.0,0.0)
    except:
        swn_score=(0.0,0.0)
        
    return swn_score
#######################################################

def swn_sentiment(token_list):
    #input: a list of tokens
    #output: list of [pos sentiment,neg sentiment]
    #uses sentiwordnet, requires parse from pattern
    #convert tokens to string
    tweet_text = " ".join(token_list)
    #remove ticker symbols so as they are assigned 0 sentiment score
    tweet_text = tweet_text.replace('$','TICKSYMBOL_')
    #remove hashtags so that they receive sentiment scores
    tweet_text = tweet_text.replace('#','')
    #tag each element in the string with a POS, then split into a list
    tweet_text=parse(tweet_text).split()
    N=len(tweet_text[0])
    #assign sentiment to each element of the parsed string
    sentiment_list=[get_sentiment(tweet_text,i) for i in range(N)]
    #sum up the sentiment scores (pos and neg) for each tweet
    senti_out=[sum([sentiment_list[x][i] for x in range(len(sentiment_list))]) for i in range(2)]
    return senti_out
##############################################################################################################
##############################################################################################################
##############################################################################################################
#EXAMPLE: 
pattern_bad_parse=parse('he is a bad man of crime that dances violently')
temp=pattern_bad_parse.split()[0]
for i in range(len(temp)):
    try:
        print swn.senti_synsets(temp[i][0],get_wordnet_pos(temp[i][1]))[0]
    except:
        print "no entry in sentiwordnet"

#######################################################
#EXAMPLE: test on an actual tweet in the DataFrame
#list of tokens
tweet_text_list=DF.ix[0,7]
#convert tokens to string
tweet_test_str = " ".join(tweet_text_list)
#remove ticker symbols so as they are assigned 0 sentiment score
tweet_test_str = tweet_test_str.replace('$','TICKSYMBOL_')
#remove hashtags so that they receive sentiment scores
tweet_test_str = tweet_test_str.replace('#','')
#tag each element in the string with a POS, then split into a list
tweet_test_str=parse(tweet_test_str).split()

for i in range(len(tweet_test_str[0])):
    try:
        print swn.senti_synsets(tweet_test_str[0][i][0],get_wordnet_pos(tweet_test_str[0][i][1]))[0]
    except:
        print "no entry in sentiwordnet"


#######################################################
#score the sentiment of each tweet that references a ticker
senti_list=[]
senti_list=[swn_sentiment(DF_tick.ix[i,7]) for i in DF_tick.index]
#save the sentiment scores in the dataframe
DF_tick[12]=senti_list

